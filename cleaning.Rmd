---
title: "Dirty Data Cleaning and Transformation "
author: "Kar Ng"
date: "2021"
output: 
  github_document: 
    toc: true
    toc_depth: 3
always_allow_html: yes

---

***

![](https://raw.githubusercontent.com/KAR-NG/cleaning/main/pic4_thumbnail.JPG)

***

## 1 R PACKAGES

Following codes load required R packages for this project.

```{r, warning=FALSE, message=FALSE}
library(tidyverse)
library(skimr)
library(agridat)

```


## 2 INTRODUCTION

Data cleaning, manipulation and transformation are very important in data science. They process datasets and convert them into a format that is usable for later analysis such as visualisation and creating predictive models. 

This project is a side project to demonstrate my data cleaning skills. I hope this project is comprehensive enough for your reference. You could visit my other projects on my [Github](https://github.com/KAR-NG) repository to view how I cleaned up data for many other projects. All my projects have a section of data cleaning. 

In this project, I will clean a public dataset from a R package - "agridate", the dataset is called "bridges.cucumber". This dataset has actually been cleaned but I downloaded the data, devastate, ruin and mess it. The single cleaned table has been spitted into 4 tables with a numbers of cleaning tasks. 

![](https://raw.githubusercontent.com/KAR-NG/cleaning/main/pic0_4Tables.JPG)



How the original dataset is like? 

```{r}
data("bridges.cucumber", package = "agridat")
bridges.cucumber

```

This dataset records the results of a cucumber experiment with variables - loc (location), gen (genotype), row (row position of the trial block), col (column position of the trial block) and lastly, the yield.  


## 3 DATA IMPORT

Following codes import the 4 tables. 

```{r}
table1 <- read.csv("cucum1.csv", fileEncoding = "UTF-8-BOM")

table2 <- read.csv("cucum2.csv", fileEncoding = "UTF-8-BOM")

table3 <- read.csv("cucum3.csv", fileEncoding = "UTF-8-BOM")

table4 <- read.csv("cucum4.csv", fileEncoding = "UTF-8-BOM")

```

## 4 DATA CLEANING

### 4.1 Cleaning table 1

Main tasks identified from table 1:

![](https://raw.githubusercontent.com/KAR-NG/cleaning/main/pic1_table1.JPG)

* Rename the column names.  
* Split the first column into two.  
* Strings manipulation in the first column.  
* Fill up the missing values of the first column.   
* Convert the *4000* in the "row" into 4, according to adjacent values of this column.   
* Convert the *1000* in the "column" into 1,  according to adjacent values of this column.  


**Structural and variable names conversion**

```{r}

table1 <- table1 %>%
  separate("Llocation.genotype", into = c("loc", "gen"), sep = "-") %>% 
  rename(row = rowrow,
         col = column,
         yield = yield.g) %>% 
  mutate_if(is.character, as.factor)
  

summary(table1)

```

In the column of "loc", I have to convert all strings into "Clemson". For the column of "gen", I need to convert those undesirable strings according to the most likely adjacent values. 

**Cleaning the strings**

```{r}
table1 <- table1 %>% 
  mutate(loc = replace(loc, loc == "", "Clemson"),   # I am already sure that this blank cell is "Clemson".
         loc = replace(loc, loc == "Clem", "Clemson"),
         loc = replace(loc, loc == "Clem_son", "Clemson"),
         loc = replace(loc, loc == "CLEMSON", "Clemson"),
         loc = as.character(loc),                    # for factor's levels cleaning. 
         gen = as.character(gen),                    # To use case when, variable has to be character
         gen = case_when(gen == "" ~ "Dasher",      # Same nature as replace, I know this blank is "Dasher".
                         gen == "poinsett" ~ "Poinsett",
                         gen == "s" ~ "Sprint",
                         TRUE ~ gen)) %>% 
  mutate_if(is.character, as.factor)

summary(table1)

```

Next, I will clean up the 4000 and 1000 in the "row" and "col" columns.
 
**Cleaning outlier values in row and col**

```{r}

table1 <- table1 %>% 
  mutate(row = replace(row, row == 4000, 4),
         col = replace(col, col == 1000, 1))
  
summary(table1)

```

The cleaning of table 1 has now completed. 

### 4.2 Cleaning table 2

Main tasks identified:

![](https://raw.githubusercontent.com/KAR-NG/cleaning/main/pic2_table2.JPG)

* Trim leading and trailing white spaces.  
* Remove the first column.  
* Rename column names.  
* Clean the strings in location and genotype.
* Combine yield_x, yield_y, and yield_z


**Structural and variable names conversion**

```{r}
tbl2 <- table2 %>% 
  rename(loc = Llocation,             # Change variable names
         gen = genotype,
         row = rowrow,
         col = colu....mn) %>% 
  select(-X) %>%                      # remove first column
  mutate(loc = trimws(loc),           # trim leading and trailing white spaces 
         gen = trimws(gen)) %>% 
  mutate_if(is.character, as.factor)  # changing character variables to factor


summary(tbl2)

```

In the column "loc", all values are actually "Tifton" based on the original dataset, and it is my job to convert all other strings into "Tifton". In the column "gen", I will need to rectify a typo of Poinsett and fill up 2 blank cells. 

**Cleaning the strings**

```{r}
tbl2 <- tbl2 %>% 
  mutate_if(is.factor, as.character) %>% 
  mutate(loc = case_when(loc == "t" ~ "Tifton",
                         loc == "T" ~ "Tifton",
                         loc == "Ti   fton" ~ "Tifton",
                         loc == "Tif" ~ "Tifton",
                         TRUE ~ loc),
         loc = replace(loc, loc == "Tiftaaon", "Tifton"),
         gen = replace(gen, gen == "Poi    nsett", "Poinsett"),
         gen = replace(gen, gen == "", NA)) %>% 
  fill(gen) %>%                               
  mutate_if(is.character, as.factor)


summary(tbl2)


```

Next I will need to combine yield x, y, and z into 1 single column with a name, "yield".

**Combine the column yield x, y and z**

```{r}
table2 <- tbl2 %>%
  mutate(yield = paste0(yield.x, yield_y, yield_z)) %>% 
  mutate(yield = str_remove_all(yield, pattern = "NA")) %>% 
  select(-5, -6, -7)

table2
 


```

The cleaning of table 2 has now completed.


### 4.3 Cleaning tables 3 and 4

This section will clean 3 and 4 together and combine them into 1.

Main tasks identified:

![](https://raw.githubusercontent.com/KAR-NG/cleaning/main/pic3_table3_table4.JPG)

* Merge 2 tables together.  
* Rename variable names.  
* Remove the irrelevant row 3 (id = 3).     
* Fix the typo "10" in the column of ROW in table 4.
* Convert the levels of location and genotype into a proper case with only the first character being upper case.    


```{r}
table3 <- table3 %>% 
  left_join(table4, by = "id") %>% 
  select(-1) %>% 
  rename(loc = LOCATION,
         gen = GENOTYPE,
         row = ROW,
         col = COLUMN,
         yield = YIELD.G) %>% 
  mutate(loc = replace(loc, loc == "TIFTON", "Tifton"),
         gen = replace(gen, gen == "SPRINT", "Sprint")) %>% 
  filter(loc != "GATTON")


```

The cleaning of tables 3 and 4 has now completed.

### 4.4  Combine all tables

Finally, 3 tables are combined into one final table. 

```{r}
final_table <- rbind(table1, table2, table3)

final_table <- final_table %>% 
  mutate(yield = as.double(yield))

final_table

```



**Final "health check"**

There are no missing values in the dataset by examining the variables "n_missing" and "complete_rate" of following table.

```{r}
skim_without_charts(final_table)

```
Following code checks the data and variable types - All good.

```{r}
glimpse(final_table)

```

I can clearly see that there are two location "Clemson" and "Tifton" as well as 4 cucumber genotypes represented by "gen". Both variables have equal sample sizes among their attribute (or known as "level"). 

```{r}
summary(final_table)
```

This project is not meant to draw graphs but I am drawing one to inspect and compare my final cleaned table with the original dataset from the R package, named "bridges.cucumber". 

```{r}

# Set up dataframe / combine final table with the original dataset

group <- rep(c("final_table", "original"), each = 32)
test <- rbind(final_table, bridges.cucumber)
test <- cbind(group, test)

# Plot

ggplot(test, aes(x = fct_reorder(gen, yield), y = yield, fill = group)) +
  geom_boxplot() +
  facet_wrap(~ group) +
  theme_bw() +
  theme(legend.position = "none",
        strip.text = element_text(size = 12),
        axis.title.x = element_text(margin = margin(10, 0, 0, 0)),
        axis.title.y = element_text(margin = margin(0, 10, 0, 0)),
        plot.title = element_text(face = "bold", vjust = 2)) +
  labs(x = "Cucumber genotype",
       y = "Yield, g",
       title = "Comparing Final Table with the Original to Check for Disparity")

  
```

Both tables are identical which indicates that the data cleaning tasks of this project has been successful. 


## 5 CONCLUSION

In conclusion, this project successfully uses R codes to clean and combine four messy tables into one that has a perfect format for analysis.



*Thank you for reading.*


## 6 REFERENCE

https://cran.r-project.org/web/packages/agridat/agridat.pdf


